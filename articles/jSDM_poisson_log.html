<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poisson log-linear regression • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Poisson log-linear regression">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jSDM_binomial_logit.html">Binomial logistic regression</a>
    </li>
    <li>
      <a href="../articles/jSDM_binomial_probit_block.html">Bernoulli probit regression</a>
    </li>
    <li>
      <a href="../articles/jSDM_boral.html">Comparison jSDM-boral</a>
    </li>
    <li>
      <a href="../articles/jSDM_poisson_log.html">Poisson log-linear regression</a>
    </li>
    <li>
      <a href="../articles/proof.html">Bayesian inference methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://twitter.com/ghislainv">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/ghislainv/jSDM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Poisson log-linear regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/master/vignettes/jSDM_poisson_log.Rmd"><code>vignettes/jSDM_poisson_log.Rmd</code></a></small>
      <div class="hidden name"><code>jSDM_poisson_log.Rmd</code></div>

    </div>

    
    
<div id="definition-of-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#definition-of-the-model" class="anchor"></a><span class="header-section-number">1</span> Definition of the model</h1>
<p>Referring to the models used in the articles <span class="citation">Hui (<a href="#ref-Hui2016">2016</a>)</span>, we define the following model :</p>
<p><span class="math display">\[ \mathrm{log}(\theta_{ij}) =\alpha_i + \beta_{0j}+X_i.\beta_j+ W_i.\lambda_j \]</span></p>
<ul>
<li><p>Link function logarithm : <span class="math inline">\(\mathrm{log}: p \rightarrow \log(p)\)</span>.</p></li>
<li><p>Response variable: <span class="math inline">\(Y=(y_{ij})^{i=1,\ldots,nsite}_{j=1,\ldots,nsp}\)</span> with:</p></li>
</ul>
<p><span class="math display">\[y_{ij} \sim \mathcal{P}oisson(\theta_{ij})\]</span>.</p>
<p><span class="math display">\[y_{ij}=\begin{cases}
    0 &amp; \text{if species $j$ has been observed as absent at site $i$}\\
    n &amp;  \text{if $n$ individuals of the species $j$ have been observed at the site $i$}.
    \end{cases}\]</span></p>
<ul>
<li><p>Latent variables: <span class="math inline">\(W_i=(W_i^1,\ldots,W_i^q)\)</span> where <span class="math inline">\(q\)</span> is the number of latent variables considered, which has to be fixed by the user (by default q=2).
We assume that <span class="math inline">\(W_i \sim \mathcal{N}(0,I_q)\)</span> and we define the associated coefficients: <span class="math inline">\(\lambda_j=(\lambda_j^1,\ldots, \lambda_j^q)'\)</span>. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,10)\)</span> for all lambdas not concerned by constraints to <span class="math inline">\(0\)</span> on upper diagonal and to strictly positive values on diagonal.</p></li>
<li><p>Explanatory variables: bioclimatic data about each site. <span class="math inline">\(X=(X_i)_{i=1,\ldots,nsite}\)</span> with <span class="math inline">\(X_i=(x_i^1,\ldots,x_i^p)\in \mathbb{R}^p\)</span> where <span class="math inline">\(p\)</span> is the number of bioclimatic variables considered.
The corresponding regression coefficients for each species <span class="math inline">\(j\)</span> are noted : <span class="math inline">\(\beta_j=(\beta_j^1,\ldots,\beta_j^p)'\)</span>.</p></li>
<li><p><span class="math inline">\(\beta_{0j}\)</span> correspond to the intercept for species <span class="math inline">\(j\)</span> which is assume to be a fixed effect. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,100)\)</span> for all betas.</p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> represents the random effect of site <span class="math inline">\(i\)</span> such as <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_{\alpha})\)</span> and we assumed that <span class="math inline">\(V_{\alpha} \sim \mathcal {IG}(\text{shape}=0.5, \text{rate}=0.005)\)</span> as prior distribution by default.</p></li>
</ul>
</div>
<div id="abundance-data-set" class="section level1">
<h1 class="hasAnchor">
<a href="#abundance-data-set" class="anchor"></a><span class="header-section-number">2</span> Abundance data-set</h1>

<div class="figure" style="text-align: center">
<span id="fig:mites-picture"></span>
<img src="figures/Oribatid_mites.jpg" alt="Oribatid mites (Borcard &amp; Legendre 1994)." width="500" height="400"><p class="caption">
Figure 2.1: <strong><em>Oribatid mites</em></strong> <span class="citation">(Borcard &amp; Legendre <a href="#ref-Borcard1994">1994</a>)</span>.
</p>
</div>
<p>This data-set is available in the <code>jSDM-package</code>. It can be loaded with the <code>data</code> command. The <code>mites</code> data-set is in “wide” format: each line is a site and the abundance data are in columns.</p>
<p>This example data set is composed of 70 cores of mostly Sphagnum mosses collected on the territory of the Station de biologie des Laurentides of Université de Montréal, Québec, Canada in June 1989.</p>
<p>The whole sampling area was 2.5 m x 10 m in size and thirty-five taxa were recognized as species, though many were not given a species name, owing to the incomplete stage of systematic knowledge of the North American Oribatid fauna.</p>
<p>The data set comprises the abundances of 35 morphospecies, 5 substrate and micritopographic variables, and the x-y Cartesian coordinates of the 70 sampling sites.</p>
<p>See Borcard et al. (1992, 1994) for details.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">jSDM</span>)
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## jSDM R package </span>
<span class="co">#&gt; ## For joint species distribution models </span>
<span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span>
<span class="co">#&gt; ##</span>
<span class="co"># mites data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">mites</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">mites</span>)
<span class="co">#&gt;   Brachy PHTH HPAV RARD SSTR Protopl MEGR MPRO TVIE HMIN HMIN2 NPRA TVEL ONOV</span>
<span class="co">#&gt; 1     17    5    5    3    2       1    4    2    2    1     4    1   17    4</span>
<span class="co">#&gt; 2      2    7   16    0    6       0    4    2    0    0     1    3   21   27</span>
<span class="co">#&gt; 3      4    3    1    1    2       0    3    0    0    0     6    3   20   17</span>
<span class="co">#&gt; 4     23    7   10    2    2       0    4    0    1    2    10    0   18   47</span>
<span class="co">#&gt; 5      5    8   13    9    0      13    0    0    0    3    14    3   32   43</span>
<span class="co">#&gt; 6     19    7    5    9    3       2    3    0    0   20    16    2   13   38</span>
<span class="co">#&gt;   SUCT LCIL Oribatul1 Ceratoz1 PWIL Galumna1 Steganacarus2 HRUF Trhypochth1</span>
<span class="co">#&gt; 1    9   50         3        1    1        8             0    0           0</span>
<span class="co">#&gt; 2   12  138         6        0    1        3             9    1           1</span>
<span class="co">#&gt; 3   10   89         3        0    2        1             8    0           3</span>
<span class="co">#&gt; 4   17  108        10        1    0        1             2    1           2</span>
<span class="co">#&gt; 5   27    5         1        0    5        2             1    0           1</span>
<span class="co">#&gt; 6   39    3         5        0    1        1             8    0           4</span>
<span class="co">#&gt;   PPEL NCOR SLAT FSET Lepidozetes Eupelops Minigalumna LRUG PLAG2 Ceratoz3</span>
<span class="co">#&gt; 1    0    0    0    0           0        0           0    0     0        0</span>
<span class="co">#&gt; 2    1    2    2    2           1        0           0    0     0        0</span>
<span class="co">#&gt; 3    0    2    0    8           0        0           0    0     0        0</span>
<span class="co">#&gt; 4    1    3    2   12           0        0           0    0     0        0</span>
<span class="co">#&gt; 5    0    0    0   12           2        0           0    0     0        0</span>
<span class="co">#&gt; 6    0    1    0   10           0        0           0    0     0        0</span>
<span class="co">#&gt;   Oppia.minus Trimalaco2 substrate shrubs    topo density   water   x   y</span>
<span class="co">#&gt; 1           0          0      sph1    few hummock  39.179 350.148 0.2 0.1</span>
<span class="co">#&gt; 2           0          0    litter    few hummock  54.989 434.815 1.0 0.1</span>
<span class="co">#&gt; 3           0          0     inter    few hummock  46.069 371.720 1.2 0.3</span>
<span class="co">#&gt; 4           0          0      sph1    few hummock  48.187 360.501 1.4 0.5</span>
<span class="co">#&gt; 5           0          0      sph1    few hummock  23.551 204.126 2.4 0.7</span>
<span class="co">#&gt; 6           0          0      sph1    few hummock  57.318 311.551 1.8 0.9</span></pre></body></html></div>
<p>We rearrange the data in two data-sets: a first one for the abundance observations for each species (columns) at each site (rows), and a second one for the site characteristics.</p>
<p>We also normalize the continuous explicative variables to facilitate MCMC convergence.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># data.obs</span>
<span class="no">PA_mites</span> <span class="kw">&lt;-</span> <span class="no">mites</span>[,<span class="fl">1</span>:<span class="fl">35</span>]
<span class="co"># Remove species with less than 10 presences</span>
<span class="no">rare_sp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">PA_mites</span> <span class="kw">&gt;</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="no">sum</span>) <span class="kw">&lt;</span> <span class="fl">10</span>)
<span class="no">PA_mites</span> <span class="kw">&lt;-</span> <span class="no">PA_mites</span>[, -<span class="no">rare_sp</span>]
<span class="co"># Normalized continuous variables</span>
<span class="no">Env_mites</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">mites</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"density"</span>,<span class="st">"water"</span>)]), <span class="no">mites</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"substrate"</span>, <span class="st">"shrubs"</span>, <span class="st">"topo"</span>)])
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">Env_mites</span>)
<span class="co">#&gt; 'data.frame':    70 obs. of  5 variables:</span>
<span class="co">#&gt;  $ density  : num  -0.00872 1.315 0.56816 0.74549 -1.3172 ...</span>
<span class="co">#&gt;  $ water    : num  -0.425 0.17 -0.273 -0.352 -1.451 ...</span>
<span class="co">#&gt;  $ substrate: Factor w/ 7 levels "inter","litter",..: 4 2 1 4 4 4 4 1 2 4 ...</span>
<span class="co">#&gt;  $ shrubs   : Factor w/ 3 levels "few","many","none": 1 1 1 1 1 1 1 2 2 2 ...</span>
<span class="co">#&gt;  $ topo     : Factor w/ 2 levels "blanket","hummock": 2 2 2 2 2 2 2 1 1 2 ...</span></pre></body></html></div>
</div>
<div id="parameter-inference" class="section level1">
<h1 class="hasAnchor">
<a href="#parameter-inference" class="anchor"></a><span class="header-section-number">3</span> Parameter inference</h1>
<p>We use the <code>jSDM_poisson_log</code> function to fit the jSDM (increase the number of iterations to achieve convergence).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">mod_mites_jSDM_log</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log</a></span>(
  <span class="co"># Chains</span>
  <span class="kw">burnin</span><span class="kw">=</span><span class="fl">1000</span>, <span class="kw">mcmc</span><span class="kw">=</span><span class="fl">1000</span>, <span class="kw">thin</span><span class="kw">=</span><span class="fl">1</span>,
  <span class="co"># Response variable </span>
  <span class="kw">presence_site_sp</span><span class="kw">=</span><span class="no">PA_mites</span>,
  <span class="co"># Explanatory variables </span>
  <span class="kw">site_suitability</span> <span class="kw">=</span> ~<span class="no">.</span>,
  <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">Env_mites</span>,
  <span class="co"># Model specification </span>
  <span class="kw">n_latent</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">site_effect</span><span class="kw">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values</span>
  <span class="kw">alpha_start</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">beta_start</span><span class="kw">=</span><span class="fl">0</span>,
  <span class="kw">lambda_start</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">W_start</span><span class="kw">=</span><span class="fl">0</span>,
  <span class="kw">V_alpha</span><span class="kw">=</span><span class="fl">1</span>,
  <span class="co"># Priors</span>
  <span class="kw">shape</span><span class="kw">=</span><span class="fl">0.5</span>, <span class="kw">rate</span><span class="kw">=</span><span class="fl">0.0005</span>,
  <span class="kw">mu_beta</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">V_beta</span><span class="kw">=</span><span class="fl">100</span>,
  <span class="kw">mu_lambda</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">V_lambda</span><span class="kw">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  <span class="kw">ropt</span><span class="kw">=</span><span class="fl">0.44</span>,
  <span class="kw">seed</span><span class="kw">=</span><span class="fl">1234</span>, <span class="kw">verbose</span><span class="kw">=</span><span class="fl">1</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.406 lambda:0.215 W:0.262 alpha:0.197</span>
<span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.446 lambda:0.350 W:0.368 alpha:0.359</span>
<span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.445 lambda:0.411 W:0.421 alpha:0.432</span>
<span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.438 lambda:0.429 W:0.440 alpha:0.429</span>
<span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.447 lambda:0.435 W:0.430 alpha:0.437</span>
<span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.453 lambda:0.452 W:0.473 alpha:0.453</span>
<span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.445 lambda:0.441 W:0.479 alpha:0.434</span>
<span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.446 lambda:0.460 W:0.504 alpha:0.446</span>
<span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.451 lambda:0.453 W:0.470 alpha:0.438</span>
<span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.445 lambda:0.456 W:0.489 alpha:0.453</span></pre></body></html></div>
</div>
<div id="analysis-of-the-results" class="section level1">
<h1 class="hasAnchor">
<a href="#analysis-of-the-results" class="anchor"></a><span class="header-section-number">4</span> Analysis of the results</h1>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">model_spec</span>$<span class="no">beta_start</span>)

<span class="co">## beta_j of the first species</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">2</span>))
<span class="kw">for</span> (<span class="no">p</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">np</span>) {
  <span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span>(<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.sp</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sp_"</span>,<span class="fl">1</span>)]][,<span class="no">p</span>]))
  <span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span>(<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.sp</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sp_"</span>,<span class="fl">1</span>)]][,<span class="no">p</span>]),
                 <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.sp</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sp_"</span>,<span class="fl">1</span>)]])[<span class="no">p</span>],
                              <span class="st">", species : "</span>,<span class="fl">1</span>))
}</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/plot-results-log-1.png" width="576" style="display: block; margin: auto;"><img src="jSDM_poisson_log_files/figure-html/plot-results-log-2.png" width="576" style="display: block; margin: auto;"><img src="jSDM_poisson_log_files/figure-html/plot-results-log-3.png" width="576" style="display: block; margin: auto;"><img src="jSDM_poisson_log_files/figure-html/plot-results-log-4.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">
<span class="co">## lambda_j of the first two species</span>
<span class="no">n_latent</span> <span class="kw">&lt;-</span> <span class="no">mod_mites_jSDM_log</span>$<span class="no">model_spec</span>$<span class="no">n_latent</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>))
<span class="kw">for</span> (<span class="no">j</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">2</span>) {
  <span class="kw">for</span> (<span class="no">l</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_latent</span>) {
    <span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.sp</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sp_"</span>,<span class="no">j</span>)]][,<span class="no">np</span>+<span class="no">l</span>])
    <span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.sp</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sp_"</span>,<span class="no">j</span>)]][,<span class="no">np</span>+<span class="no">l</span>],
                   <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.sp</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sp_"</span>,<span class="no">j</span>)]])
                                [<span class="no">np</span>+<span class="no">l</span>], <span class="st">", species : "</span>,<span class="no">j</span>))
  }
}</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/plot-results-log-5.png" width="576" style="display: block; margin: auto;"><img src="jSDM_poisson_log_files/figure-html/plot-results-log-6.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## Latent variables W_i for the first two sites</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>))
<span class="kw">for</span> (<span class="no">l</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_latent</span>) {
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">2</span>) {
  <span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.latent</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"lv_"</span>,<span class="no">l</span>)]][,<span class="no">i</span>],
                  <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Latent variable W_"</span>, <span class="no">l</span>, <span class="st">", site "</span>, <span class="no">i</span>))
  <span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.latent</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"lv_"</span>,<span class="no">l</span>)]][,<span class="no">i</span>],
                 <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Latent variable W_"</span>, <span class="no">l</span>, <span class="st">", site "</span>, <span class="no">i</span>))
  }
}</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/plot-results-log-7.png" width="576" style="display: block; margin: auto;"><img src="jSDM_poisson_log_files/figure-html/plot-results-log-8.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="co">## alpha_i of the first two sites</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.alpha</span>[,<span class="fl">1</span>:<span class="fl">2</span>]))</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/plot-results-log-9.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r">
<span class="co">## V_alpha</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>))
<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.V_alpha</span>)
<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.V_alpha</span>)
<span class="co">## Deviance</span>
<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.Deviance</span>)
<span class="kw pkg">coda</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">mcmc.Deviance</span>)</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/plot-results-log-10.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
<span class="co">## probit_theta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span> (<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">theta_latent</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Predicted log theta"</span>, <span class="kw">xlab</span> <span class="kw">=</span><span class="st">"predicted log theta"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">theta_latent</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Predicted theta"</span>, <span class="kw">xlab</span> <span class="kw">=</span><span class="st">"predicted theta"</span>)</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/plot-results-log-11.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="matrice-of-correlations" class="section level1">
<h1 class="hasAnchor">
<a href="#matrice-of-correlations" class="anchor"></a><span class="header-section-number">5</span> Matrice of correlations</h1>
<p>After fitting the jSDM with latent variables, the <strong>fullspecies residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, nspecies}_{j=1,\ldots, nspecies}\)</span> can bederived from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \begin{cases}
 \lambda_i .\lambda_j^T &amp; \text{ if } i \neq j \\
  \lambda_i .\lambda_j^T + 1 &amp; \text{ if } i=j
 \end{cases}\]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
<p>We use the function <code>plot_residual_cor</code> to compute and display the residual correlation matrix between species :</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_residual_cor.html">plot_residual_cor</a></span>(<span class="no">mod_mites_jSDM_log</span>, <span class="kw">tl.cex</span><span class="kw">=</span><span class="fl">0.5</span>)</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/correlation-matrix-log-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="predictions" class="section level1">
<h1 class="hasAnchor">
<a href="#predictions" class="anchor"></a><span class="header-section-number">6</span> Predictions</h1>
<p>We use the <code>predict.jSDM</code> S3 method on the <code>mod_mites_jSDM_log</code> object of class <code>jSDM</code> to compute the mean (or expectation) of the posterior distributions obtained and get the expected values of model’s parameters.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Sites and species concerned by predictions :</span>
<span class="co">## 35 sites among the 70</span>
<span class="no">Id_sites</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">PA_mites</span>), <span class="fl">35</span>)
<span class="co">## 20 species among the 30 </span>
<span class="no">Id_species</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">PA_mites</span>),<span class="fl">20</span>)
<span class="co"># Simulate new observations of covariates on those sites </span>
<span class="no">simdata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw">nrow</span><span class="kw">=</span><span class="fl">35</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">model_spec</span>$<span class="no">site_data</span>))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">simdata</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">mod_mites_jSDM_log</span>$<span class="no">model_spec</span>$<span class="no">site_data</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">simdata</span>) <span class="kw">&lt;-</span> <span class="no">Id_sites</span>
<span class="no">simdata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">simdata</span>)
<span class="no">simdata</span>$<span class="no">density</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">35</span>)
<span class="no">simdata</span>$<span class="no">water</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">35</span>)
<span class="no">simdata</span>$<span class="no">substrate</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"inter"</span>, <span class="st">"litter"</span>, <span class="st">"peat"</span>, <span class="st">"sph1"</span>, <span class="st">"sph2"</span>, <span class="st">"sph3"</span>, <span class="st">"sph4"</span>), <span class="fl">35</span>, <span class="kw">replace</span><span class="kw">=</span><span class="no">T</span>)
<span class="no">simdata</span>$<span class="no">shrubs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"none"</span>,<span class="st">"many"</span>, <span class="st">"few"</span>), <span class="fl">35</span>, <span class="kw">replace</span><span class="kw">=</span><span class="no">T</span>)
<span class="no">simdata</span>$<span class="no">topo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"blanket"</span>,<span class="st">"hummock"</span>), <span class="fl">35</span>, <span class="kw">replace</span><span class="kw">=</span><span class="no">T</span>)

<span class="co"># Predictions </span>
<span class="no">theta_pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mod_mites_jSDM_log</span>, <span class="kw">newdata</span><span class="kw">=</span><span class="no">simdata</span>, <span class="kw">Id_species</span><span class="kw">=</span><span class="no">Id_species</span>,
                           <span class="kw">Id_sites</span><span class="kw">=</span><span class="no">Id_sites</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"mean"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">theta_pred</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Predicted theta with simulated data"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"predicted theta"</span>)</pre></body></html></div>
<p><img src="jSDM_poisson_log_files/figure-html/predictions-log-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Borcard1994">
<p>Borcard, D. &amp; Legendre, P. (1994) Environmental control and spatial structure in ecological communities: An example using oribatid mites (Acari, Oribatei). <em>Environmental and Ecological Statistics</em>, <strong>1</strong>, 37–61.</p>
</div>
<div id="ref-Hui2016">
<p>Hui, F.K.C. (2016) Boral – Bayesian Ordination and Regression Analysis of Multivariate Abundance Data in r. <em>Methods in Ecology and Evolution</em>, <strong>7</strong>, 744–750.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://ecology.ghislainv.fr">Ghislain Vieilledent</a>, Jeanne Clément, <a href="https://www.cirad.fr"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
